{"componentChunkName":"component---src-templates-blog-post-js","path":"/compiling-graphql-query-literals-typescript-rollup/","webpackCompilationHash":"aedff796f5449d8482e2","result":{"data":{"site":{"siteMetadata":{"title":"Rem Lampa","subTitle":"On Web Development, Startups & Film Photography","author":"Rem Lampa"}},"markdownRemark":{"id":"49be8e85-e655-5acb-8b49-53f4c17b16dc","excerpt":"I am currently converting our company’s soon-to-be open-source NPM library from\nJavaScript to TypeScript; and earlier today,\nI got stuck on a roadblock. I’m…","html":"<p>I am currently converting our company’s soon-to-be open-source NPM library from\nJavaScript to <a href=\"https://www.typescriptlang.org/\">TypeScript</a>; and earlier today,\nI got stuck on a roadblock.</p>\n<p>I’m using <a href=\"https://rollupjs.org/\">Rollup</a> and <a href=\"https://www.npmjs.com/package/rollup-plugin-typescript2\"><code class=\"language-text\">rollup-plugin-typescript2</code></a>\nto compile and bundle the library. Unfortunately, it does not have support for\nGraphQL queries tagged by <a href=\"https://www.npmjs.com/package/graphql-tag\"><code class=\"language-text\">graphql-tag</code></a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> gql <span class=\"token keyword\">from</span> <span class=\"token string\">'graphql-tag'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// this produces \"gql is not defined\" error</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">SOME_QUERY</span> <span class=\"token operator\">=</span> gql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  ...some graphql query\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Worse, since Rollup is a relatively new bundling tool (compared to something like\n<a href=\"https://webpack.js.org/\">Webpack</a>), there’s not much information out there on how\nto configure it to compile GraphQL tagged literals.</p>\n<p>Through hours of digging through Google and library documentation, I found this\npackage called <a href=\"https://www.npmjs.com/package/ts-transform-graphql-tag\"><code class=\"language-text\">ts-transform-graphql-tag</code></a>.\nThere’s another problem though, while the package’s README, discusses how to\nintegrate it with Webpack and <a href=\"https://fuse-box.org/\">Fusebox</a>, it doesn’t mention\nanything about Rollup.</p>\n<p>Miraculously, I found a way to make it work. Here’s how to do it:</p>\n<p>First, install the package:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> ts-transform-graphql-tag --save-dev</code></pre></div>\n<p>Then in <code class=\"language-text\">rollup.config.js</code>, add the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// imports...</span>\n<span class=\"token keyword\">import</span> typescript <span class=\"token keyword\">from</span> <span class=\"token string\">'rollup-plugin-typescript2'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getTransformer <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'ts-transform-graphql-tag'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">graphQLTransformer</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  before<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token function\">getTransformer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    input<span class=\"token punctuation\">:</span> <span class=\"token string\">'src/index.ts'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// rollup options...</span>\n    plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token comment\">// rollup plugins...</span>\n      <span class=\"token function\">typescript</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// typescript plugin options...</span>\n        transformers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>graphQLTransformer<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>That’s it! Do take note that at the time of writing\n(<code class=\"language-text\">rollup-plugin-typescript</code> v0.22.1), TypeScript transformers are still in\nexperimental stage. It also requires TypeScript version 2.4.1 and up.</p>","frontmatter":{"title":"Compiling Tagged GraphQL Query Literals in TypeScript with Rollup","date":"August 13, 2019"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/compiling-graphql-query-literals-typescript-rollup/","previous":{"fields":{"slug":"/the-academic-myth/"},"frontmatter":{"title":"The Academic Myth"}},"next":null}}}